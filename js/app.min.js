"use strict";

document.addEventListener('DOMContentLoaded', function () {
  // global vars
  var isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;

  // function's
  function bodyFixScroll(status) {
    var scrollPosition = 0;
    var paddingOffset = window.innerWidth - document.body.offsetWidth + 'px';
    var elementsFixed = document.querySelectorAll('.fixed');
    if (status) {
      document.body.classList.add('scroll-disabled');
      scrollPosition = window.pageYOffset;
      document.body.style.overflow = 'hidden';
      document.body.style.position = 'fixed';
      if (document.body.style.top) {
        document.body.style.top = document.body.style.top;
      } else {
        document.body.style.top = '-' + scrollPosition + 'px';
      }
      document.body.style.width = '100%';
      document.body.style.paddingRight = paddingOffset;
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.marginRight = paddingOffset;
        });
      }
    } else {
      document.body.classList.remove('scroll-disabled');
      scrollPosition = Math.abs(parseInt(document.querySelector('body').style.top.replace('px', '')));
      document.body.style.removeProperty('overflow');
      document.body.style.removeProperty('position');
      document.body.style.removeProperty('top');
      document.body.style.removeProperty('width');
      document.body.style.removeProperty('padding-right');
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.removeProperty('margin-right');
        });
      }
      window.scrollTo({
        top: !isNaN(scrollPosition) ? scrollPosition : 0,
        behavior: 'instant'
      });
    }
  }

  // checker
  var useItemChecker = function useItemChecker(els, onClickOutside) {
    var isActive = false;
    var checkBodyClick = function checkBodyClick(e) {
      var currentEl = e.target;
      while (currentEl) {
        if (els.includes(currentEl)) return;
        currentEl = currentEl.parentNode;
      }
      onClickOutside();
      removeBodyChecker();
    };
    function setBodyChecker() {
      if (!isActive) {
        document.documentElement.addEventListener('click', checkBodyClick);
        isActive = true;
      }
    }
    function removeBodyChecker() {
      if (isActive) {
        document.documentElement.removeEventListener('click', checkBodyClick);
        isActive = false;
      }
    }
    return {
      setBodyChecker: setBodyChecker,
      removeBodyChecker: removeBodyChecker
    };
  };

  // inputmask
  Inputmask().mask(document.querySelectorAll('input'));

  // textarea
  var allTexareas = document.querySelectorAll('textarea');
  if (allTexareas) {
    allTexareas.forEach(function (el) {
      el.style.height = el.setAttribute('style', 'height: ' + el.scrollHeight + 'px');
      el.classList.add('auto');
      el.addEventListener('input', function (e) {
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
      });
    });
  }

  // mobile menu
  var mobileMenu = document.getElementById('mobile-menu');
  var mobileMenuTrigger = document.getElementById('hamburger-toggle');
  if (mobileMenu && mobileMenuTrigger) {
    mobileMenuTrigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (mobileMenu.classList.contains('is--active')) {
        mobileMenuTrigger.classList.remove('is--active');
        mobileMenu.classList.remove('is--active');
        bodyFixScroll(0);
      } else {
        mobileMenuTrigger.classList.add('is--active');
        mobileMenu.classList.add('is--active');
        bodyFixScroll(1);
      }
    });
  }

  // greetings slider
  var greetingsSlider = document.querySelectorAll('.greetings__slider .swiper');
  if (greetingsSlider) {
    greetingsSlider.forEach(function (slider) {
      var myGreetingsSlider = new Swiper(slider, {
        slidesPerView: 4,
        spaceBetween: 20,
        navigation: {
          prevEl: slider.closest('.greetings__slider').querySelector('.swiper-button-prev'),
          nextEl: slider.closest('.greetings__slider').querySelector('.swiper-button-next')
        },
        pagination: {
          el: slider.closest('.greetings__slider').querySelector('.swiper-pagination'),
          type: 'progressbar'
        },
        breakpoints: {
          0: {
            slidesPerView: 1,
            spaceBetween: 10
          },
          580: {
            slidesPerView: 2,
            spaceBetween: 20
          },
          1024: {
            slidesPerView: 3,
            spaceBetween: 20
          },
          1200: {
            slidesPerView: 4,
            spaceBetween: 20
          }
        }
      });
    });
  }

  // main programs slider
  var mainProgramsSlider = document.querySelectorAll('.main-programs__slider .swiper');
  if (mainProgramsSlider) {
    mainProgramsSlider.forEach(function (slider) {
      var myMainProgramsSlider = new Swiper(slider, {
        slidesPerView: 4,
        spaceBetween: 20,
        navigation: {
          prevEl: slider.closest('.main-programs__slider').querySelector('.swiper-button-prev'),
          nextEl: slider.closest('.main-programs__slider').querySelector('.swiper-button-next')
        },
        pagination: {
          el: slider.closest('.main-programs__slider').querySelector('.swiper-pagination'),
          type: 'progressbar'
        },
        breakpoints: {
          0: {
            slidesPerView: 1,
            spaceBetween: 10
          },
          580: {
            slidesPerView: 2,
            spaceBetween: 20
          },
          1024: {
            slidesPerView: 3,
            spaceBetween: 20
          },
          1200: {
            slidesPerView: 4,
            spaceBetween: 20
          }
        }
      });
    });
  }

  // main partners slider
  var mainPartnersSlider = document.querySelectorAll('.main-partners__slider .swiper');
  if (mainPartnersSlider) {
    if (window.innerWidth <= 1023) {
      mainPartnersSlider.forEach(function (slider) {
        var myMainPartnersSlider = new Swiper(slider, {
          slidesPerView: 'auto',
          spaceBetween: 10,
          loop: true,
          pagination: {
            el: slider.closest('.main-partners__slider').querySelector('.swiper-pagination'),
            type: 'progressbar'
          }
        });
      });
    }
  }

  // main events slider
  var mainEventsSlider = document.querySelectorAll('.main-events__slider .swiper');
  if (mainEventsSlider) {
    if (window.innerWidth <= 1023) {
      mainEventsSlider.forEach(function (slider) {
        var myMainEventsSlider = new Swiper(slider, {
          slidesPerView: 'auto',
          spaceBetween: 10,
          loop: true,
          pagination: {
            el: slider.closest('.main-events__slider').querySelector('.swiper-pagination'),
            type: 'progressbar'
          }
        });
      });
    }
  }
});