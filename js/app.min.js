"use strict";

document.addEventListener('DOMContentLoaded', function () {
  // global vars
  var isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;

  // function's
  function bodyFixScroll(status) {
    var scrollPosition = 0;
    var paddingOffset = window.innerWidth - document.body.offsetWidth + 'px';
    var elementsFixed = document.querySelectorAll('.fixed');
    if (status) {
      document.body.classList.add('scroll-disabled');
      scrollPosition = window.pageYOffset;
      document.body.style.overflow = 'hidden';
      document.body.style.position = 'fixed';
      if (document.body.style.top) {
        document.body.style.top = document.body.style.top;
      } else {
        document.body.style.top = '-' + scrollPosition + 'px';
      }
      document.body.style.width = '100%';
      document.body.style.paddingRight = paddingOffset;
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.marginRight = paddingOffset;
        });
      }
    } else {
      document.body.classList.remove('scroll-disabled');
      scrollPosition = Math.abs(parseInt(document.querySelector('body').style.top.replace('px', '')));
      document.body.style.removeProperty('overflow');
      document.body.style.removeProperty('position');
      document.body.style.removeProperty('top');
      document.body.style.removeProperty('width');
      document.body.style.removeProperty('padding-right');
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.removeProperty('margin-right');
        });
      }
      window.scrollTo({
        top: !isNaN(scrollPosition) ? scrollPosition : 0,
        behavior: 'instant'
      });
    }
  }

  // checker
  var useItemChecker = function useItemChecker(els, onClickOutside) {
    var isActive = false;
    var checkBodyClick = function checkBodyClick(e) {
      var currentEl = e.target;
      while (currentEl) {
        if (els.includes(currentEl)) return;
        currentEl = currentEl.parentNode;
      }
      onClickOutside();
      removeBodyChecker();
    };
    function setBodyChecker() {
      if (!isActive) {
        document.documentElement.addEventListener('click', checkBodyClick);
        isActive = true;
      }
    }
    function removeBodyChecker() {
      if (isActive) {
        document.documentElement.removeEventListener('click', checkBodyClick);
        isActive = false;
      }
    }
    return {
      setBodyChecker: setBodyChecker,
      removeBodyChecker: removeBodyChecker
    };
  };

  // inputmask
  Inputmask().mask(document.querySelectorAll('input'));

  // textarea
  var allTexareas = document.querySelectorAll('textarea');
  if (allTexareas) {
    allTexareas.forEach(function (el) {
      el.style.height = el.setAttribute('style', 'height: ' + el.scrollHeight + 'px');
      el.classList.add('auto');
      el.addEventListener('input', function (e) {
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
      });
    });
  }

  // select
  (function () {
    var selectBoxes = document.querySelectorAll('.select-box');
    if (!selectBoxes.length) return;
    function closeBox(box) {
      box.classList.remove('is--active');
      document.removeEventListener('click', box._onBodyClick);
    }
    selectBoxes.forEach(function (selectBox) {
      var isSingle = selectBox.classList.contains('select-box--single');
      var selectedEl = selectBox.querySelector('.select-box__selected');
      var placeholder = selectedEl.querySelector('.select-box__placeholder');
      var valuesDisp = selectedEl.querySelector('.select-box__values');
      function onBodyClick(e) {
        if (!selectBox.contains(e.target)) {
          closeBox(selectBox);
        }
      }
      selectBox._onBodyClick = onBodyClick;
      function updateMulti() {
        var checked = Array.from(selectBox.querySelectorAll('input[type="checkbox"]:checked'));
        var count = checked.length;
        console.log('> updateMulti â€” selected count:', count);
        var titles = checked.map(function (input) {
          var _opt$querySelector, _opt$querySelector2;
          var opt = input.closest('.select-box__option');
          return (opt === null || opt === void 0 || (_opt$querySelector = opt.querySelector('.select-box__value')) === null || _opt$querySelector === void 0 ? void 0 : _opt$querySelector.textContent.trim()) || (opt === null || opt === void 0 || (_opt$querySelector2 = opt.querySelector('.select-box__title')) === null || _opt$querySelector2 === void 0 ? void 0 : _opt$querySelector2.textContent.trim()) || '';
        }).filter(function (t) {
          return t;
        });
        valuesDisp.textContent = titles.join(', ');
        selectBox.classList.toggle('is--selected', count > 0);
      }
      selectedEl.addEventListener('click', function (e) {
        e.stopPropagation();
        if (selectBox.classList.contains('is--active')) {
          closeBox(selectBox);
        } else {
          selectBoxes.forEach(function (sb) {
            return sb !== selectBox && closeBox(sb);
          });
          selectBox.classList.add('is--active');
          document.addEventListener('click', onBodyClick);
        }
      });
      selectBox.querySelectorAll('.select-box__option').forEach(function (option) {
        var _label$querySelector, _option$querySelector;
        var input = option.querySelector('input');
        var label = option.querySelector('.select-box__label');
        var title = ((_label$querySelector = label.querySelector('.select-box__title')) === null || _label$querySelector === void 0 ? void 0 : _label$querySelector.textContent.trim()) || ((_option$querySelector = option.querySelector('.select-box__value')) === null || _option$querySelector === void 0 ? void 0 : _option$querySelector.textContent.trim()) || label.textContent.trim();
        option.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();
          if (isSingle) {
            var was = input.checked;
            selectBox.querySelectorAll('input').forEach(function (i) {
              return i.checked = false;
            });
            if (!was) {
              input.checked = true;
              valuesDisp.textContent = title;
              valuesDisp.classList.add('is--active');
              placeholder.classList.remove('is--active');
              closeBox(selectBox);
            } else {
              valuesDisp.textContent = '';
              valuesDisp.classList.remove('is--active');
              placeholder.classList.add('is--active');
            }
          } else {
            input.checked = !input.checked;
            updateMulti();
          }
        });
      });
      if (!isSingle) {
        updateMulti();
      }
    });
  })();

  // menu
  var menu = document.getElementById('menu');
  var mobileMenu = document.getElementById('mobile-menu');
  var menuTrigger = document.getElementById('hamburger-toggle');
  var menuClose = document.querySelector('.menu__close');
  if (menu && mobileMenu && menuTrigger) {
    menuTrigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (window.innerWidth >= 744) {
        if (menu.classList.contains('is--active')) {
          menu.classList.remove('is--active');
          bodyFixScroll(0);
        } else {
          menu.classList.add('is--active');
          bodyFixScroll(1);
        }
      } else {
        if (mobileMenu.classList.contains('is--active')) {
          menuTrigger.classList.remove('is--active');
          mobileMenu.classList.remove('is--active');
          bodyFixScroll(0);
        } else {
          menuTrigger.classList.add('is--active');
          mobileMenu.classList.add('is--active');
          bodyFixScroll(1);
        }
      }
    });
    if (menuClose) {
      menuClose.addEventListener('click', function (event) {
        event.preventDefault();
        menu.classList.remove('is--active');
        bodyFixScroll(0);
      });
    }
  }

  // news filter
  var newsFilterTrigger = document.querySelectorAll('.news-filter__trigger');
  if (newsFilterTrigger) {
    newsFilterTrigger.forEach(function (item) {
      var close = function close() {
        var parent = item.closest('.news-filter');
        parent.classList.remove('is--active');
      };
      var itemChecker = useItemChecker([item.parentNode], close);
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = item.closest('.news-filter');
        if (window.innerWidth <= 1199) {
          if (parent.classList.contains('is--active')) {
            close();
          } else {
            parent.classList.add('is--active');
            itemChecker.setBodyChecker();
          }
        }
      });
    });
  }

  // greetings slider
  var greetingsSlider = document.querySelectorAll('.greetings__slider .swiper');
  if (greetingsSlider) {
    greetingsSlider.forEach(function (slider) {
      var myGreetingsSlider = new Swiper(slider, {
        slidesPerView: 4,
        spaceBetween: 20,
        navigation: {
          prevEl: slider.closest('.greetings__slider').querySelector('.swiper-button-prev'),
          nextEl: slider.closest('.greetings__slider').querySelector('.swiper-button-next')
        },
        pagination: {
          el: slider.closest('.greetings__slider').querySelector('.swiper-pagination'),
          type: 'progressbar'
        },
        breakpoints: {
          0: {
            slidesPerView: 1,
            spaceBetween: 10
          },
          580: {
            slidesPerView: 2,
            spaceBetween: 20
          },
          1024: {
            slidesPerView: 3,
            spaceBetween: 20
          },
          1200: {
            slidesPerView: 4,
            spaceBetween: 20
          }
        }
      });
    });
  }

  // main programs slider
  var mainProgramsSlider = document.querySelectorAll('.main-programs__slider .swiper');
  if (mainProgramsSlider) {
    mainProgramsSlider.forEach(function (slider) {
      var myMainProgramsSlider = new Swiper(slider, {
        slidesPerView: 4,
        spaceBetween: 20,
        navigation: {
          prevEl: slider.closest('.main-programs__slider').querySelector('.swiper-button-prev'),
          nextEl: slider.closest('.main-programs__slider').querySelector('.swiper-button-next')
        },
        pagination: {
          el: slider.closest('.main-programs__slider').querySelector('.swiper-pagination'),
          type: 'progressbar'
        },
        breakpoints: {
          0: {
            slidesPerView: 1,
            spaceBetween: 10
          },
          580: {
            slidesPerView: 2,
            spaceBetween: 20
          },
          1024: {
            slidesPerView: 3,
            spaceBetween: 20
          },
          1200: {
            slidesPerView: 4,
            spaceBetween: 20
          }
        }
      });
    });
  }

  // main partners slider
  var mainPartnersSlider = document.querySelectorAll('.main-partners__slider .swiper');
  if (mainPartnersSlider) {
    if (window.innerWidth <= 1023) {
      mainPartnersSlider.forEach(function (slider) {
        var myMainPartnersSlider = new Swiper(slider, {
          slidesPerView: 'auto',
          spaceBetween: 10,
          loop: true,
          pagination: {
            el: slider.closest('.main-partners__slider').querySelector('.swiper-pagination'),
            type: 'progressbar'
          }
        });
      });
    }
  }

  // main events slider
  var mainEventsSlider = document.querySelectorAll('.main-events__slider .swiper');
  if (mainEventsSlider) {
    if (window.innerWidth <= 1023) {
      mainEventsSlider.forEach(function (slider) {
        var myMainEventsSlider = new Swiper(slider, {
          slidesPerView: 'auto',
          spaceBetween: 10,
          loop: true,
          pagination: {
            el: slider.closest('.main-events__slider').querySelector('.swiper-pagination'),
            type: 'progressbar'
          }
        });
      });
    }
  }
});